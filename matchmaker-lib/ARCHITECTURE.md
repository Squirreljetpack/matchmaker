## Architecture

### Matchmaker

##### components

- Nucleo
  - worker
  - matcher
- Output function (&Input -> (u32, Output))
- Configs (see config.toml/config.rs)
- Dynamic event/interrupt handlers
- Previewer config

##### pick

```
Event(Bind, Crossterm, Event) -> Event handler -> Action(Context) -> Action -> Computation
    -> Raise Event/Interrupt -> Event/Interrupt Handlers
    -> Render
```


### Dynamic handlers

Some features such as the execute, reload, and print actions, and even the previewer do not have their behavior defined directly in the render loop.

Instead, they are attached as handlers to the Matchmaker, which are triggered by certain events and interrupts generated by the loop.

Some actions can generate these triggers, as well usually performing a minimal amount of other logic.

For example, the `Preview(bat {})` command generates a `PreviewChanged` event, and leaves the string contents as a payload in the render state. This render state is exposed to the handler, and is used to spawn the command which is then displayed to preview. The `Execute` action is another example: it simply leaves the tui before raising the execute interrupt, then re-enters before the next render -- the handler associated to the interrupt is what spawns the process in the main app. As a rule, any action with effects beyond the UI has its logic defined seperately, and is therefore be fully amenable to the needs of the application.

For more specific requirements, the set of actions can be extended with a type implementing `ActionExt`, on which a handler with mutable access to the UI state can be registered. Additionally, [`PickOptions`](./src/matchmaker.rs#L417) also supports registering an [`ext_aliaser`](./src/matchmaker.rs#L481-L484) which can be used transform actions before they are processed.